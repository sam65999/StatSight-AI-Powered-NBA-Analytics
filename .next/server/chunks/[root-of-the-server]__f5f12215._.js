module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},95448,e=>{"use strict";class t extends Error{statusCode;isRateLimitError;isTimeoutError;constructor(e,t,r,s){super(e),this.statusCode=t,this.isRateLimitError=r,this.isTimeoutError=s,this.name="AIClientError"}}class r{apiKey;siteUrl;appTitle;PRIMARY_MODEL="mistralai/mistral-small-3.1-24b-instruct:free";FALLBACK_MODEL="deepseek/deepseek-chat-v3.1:free";OPENROUTER_URL="https://openrouter.ai/api/v1/chat/completions";REQUEST_TIMEOUT=3e4;constructor(e){if(!e.apiKey)throw new t("OpenRouter API key is required");this.apiKey=e.apiKey,this.siteUrl=e.siteUrl||"http://localhost:3000",this.appTitle=e.appTitle||"StatSight AI"}async complete(e){let r=null;try{return console.log(`[AI Client] Attempting request with primary model: ${this.PRIMARY_MODEL}`),{content:await this.makeRequest(this.PRIMARY_MODEL,e),model_used:this.PRIMARY_MODEL,fallback_triggered:!1}}catch(e){if(console.error("[AI Client] Primary model failed:",(r=this.handleError(e)).message),!this.shouldFallback(r))throw r}try{return console.log(`[AI Client] Attempting request with fallback model: ${this.FALLBACK_MODEL}`),{content:await this.makeRequest(this.FALLBACK_MODEL,e),model_used:this.FALLBACK_MODEL,fallback_triggered:!0}}catch(s){let e=this.handleError(s);throw console.error("[AI Client] Fallback model also failed:",e.message),new t(`Both AI models failed. Primary: ${r?.message}. Fallback: ${e.message}`,e.statusCode)}}async makeRequest(e,r){let s=new AbortController,a=setTimeout(()=>s.abort(),this.REQUEST_TIMEOUT);try{let n=await fetch(this.OPENROUTER_URL,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":this.siteUrl,"X-Title":this.appTitle},body:JSON.stringify({model:e,messages:r.messages,temperature:r.temperature??.3,max_tokens:r.max_tokens??600,...r.response_format&&{response_format:r.response_format}}),signal:s.signal});if(clearTimeout(a),!n.ok){let e=await n.text(),r=e;try{let t=JSON.parse(e);r=t.error?.message||t.message||e}catch{}throw new t(r,n.status,429===n.status,!1)}let o=await n.json(),i=o.choices?.[0]?.message?.content;if(!i)throw new t("No content in AI response");return i}catch(e){if(clearTimeout(a),"AbortError"===e.name)throw new t(`Request timeout after ${this.REQUEST_TIMEOUT/1e3}s`,408,!1,!0);if(e instanceof t)throw e;throw new t(e.message||"Unknown error during AI request",500)}}shouldFallback(e){return e.isRateLimitError?(console.log("[AI Client] Rate limit detected, will attempt fallback"),!0):e.isTimeoutError?(console.log("[AI Client] Timeout detected, will attempt fallback"),!0):e.statusCode&&e.statusCode>=500?(console.log("[AI Client] Server error detected, will attempt fallback"),!0):!e.statusCode||!(e.statusCode>=400)||!(e.statusCode<500)||(console.log("[AI Client] Client error detected, will NOT attempt fallback"),!1)}handleError(e){return e instanceof t?e:"AbortError"===e.name?new t("Request timeout",408,!1,!0):new t(e.message||"Unknown error",e.statusCode||500)}}function s(e){let s=e||process.env.OPENROUTER_API_KEY;if(!s)throw new t("OPENROUTER_API_KEY environment variable is not set");return new r({apiKey:s,siteUrl:"http://localhost:3000",appTitle:"StatSight AI Predictions"})}function a(e,t){try{let r=e.match(/\{[\s\S]*\}/);if(r)return JSON.parse(r[0]);return console.warn("[AI Client] No JSON found in response, using fallback"),t}catch(e){return console.error("[AI Client] Error parsing JSON:",e),t}}e.s(["createAIClient",()=>s,"parseAIResponse",()=>a])},12799,e=>{"use strict";var t=e.i(47909),r=e.i(74017),s=e.i(96250),a=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),d=e.i(16795),p=e.i(87718),u=e.i(95169),c=e.i(47587),h=e.i(66012),m=e.i(70101),g=e.i(26937),f=e.i(10372),R=e.i(93695);e.i(52474);var w=e.i(5232),v=e.i(89171),y=e.i(95448);let _=new Map,E=new Map;async function A(e){try{var t,r;let s,a,n,{playerId:o,playerData:i,userQuestion:l,sessionId:d}=await e.json();if(!o||!i||!l)return v.NextResponse.json({success:!1,error:"Missing required fields: playerId, playerData, userQuestion"},{status:400});let p=d||o.toString(),u=Date.now(),c=E.get(p);if(c)if(u<c.resetTime){if(c.count>=20)return v.NextResponse.json({success:!1,error:"Rate limit exceeded. Please wait a moment before asking another question."},{status:429});c.count++}else E.set(p,{count:1,resetTime:u+6e4});else E.set(p,{count:1,resetTime:u+6e4});let h=`${o}-${l.toLowerCase().trim()}`,m=_.get(h);if(m&&u-m.timestamp<6e5)return v.NextResponse.json({success:!0,cached:!0,...m.response});let g=l.replace(/[<>{}[\]]/g,"").trim().substring(0,500),f=(t=i,r=g,a=(s=t.season_games||[]).slice(-10),n=function(e){if(!e||0===e.length)return{games_played:0,avg_points:0,avg_rebounds:0,avg_assists:0};let t=e.reduce((e,t)=>(e.points+=t.pts||t.points||0,e.rebounds+=t.reb||t.rebounds||0,e.assists+=t.ast||t.assists||0,e),{points:0,rebounds:0,assists:0});return{games_played:e.length,avg_points:(t.points/e.length).toFixed(1),avg_rebounds:(t.rebounds/e.length).toFixed(1),avg_assists:(t.assists/e.length).toFixed(1)}}(s.slice(-5)),`
[PLAYER_DATA_JSON]
${JSON.stringify({player:{id:t.id,full_name:t.full_name,position:t.position,height:t.height,weight:t.weight,team:t.team,is_active:t.is_active},season_aggregates:t.headline_stats||t.season_average||{},career_stats:t.career_stats||{},recent_form:n,season_games:a.map(e=>({date:e.date||e.game_date,opponent:e.opponent||e.matchup,points:e.pts||e.points,rebounds:e.reb||e.rebounds,assists:e.ast||e.assists,steals:e.stl||e.steals,blocks:e.blk||e.blocks,minutes:e.min||e.minutes,plus_minus:e.plus_minus,fg_pct:e.fg_pct,three_pct:e.fg3_pct}))},null,2)}

QUESTION: ${r}

INSTRUCTIONS: 
- Analyze the player data above to answer the question
- Only use the provided data for factual claims about this player
- If you need to make assumptions or generalizations, mark them as "inference"
- Cite specific games or aggregates when supporting a claim
- Be concise (1-4 sentences)
- Output MUST be valid JSON with these fields:
  {
    "answer": "Your natural-language response (1-4 sentences)",
    "confidence": "High|Medium|Low",
    "evidence": [
      {"date":"2025-01-15","points":32,"opponent":"GSW","note":"Career high this season"},
      ...up to 3 most relevant games
    ],
    "suggested_props": [
      {"stat":"points","threshold":"over 30","reason":"Averaging 32 PPG in last 5 games"}
    ] (optional, only if relevant to the question),
    "ai_placeholder": false
  }

Example questions and expected behavior:
- "Is he consistent?" → Analyze variance in recent games
- "How does he perform against strong teams?" → Look at opponent data
- "Should I bet over 25 points?" → Compare threshold to recent averages and trends
`);try{let e=(0,y.createAIClient)(),t=await e.complete({messages:[{role:"system",content:"You are an expert NBA analyst. Use ONLY the provided playerData to answer questions. If you need to generalize beyond the data, mark it explicitly as inference. Keep responses concise and support claims with evidence from playerData. Always respond in valid JSON format."},{role:"user",content:f}],temperature:.3,max_tokens:800,response_format:{type:"json_object"}}),r=(0,y.parseAIResponse)(t.content,{answer:"Unable to provide answer",confidence:"Low",evidence:[],suggested_props:[],ai_placeholder:!1}),s={answer:r.answer||"Unable to provide answer",confidence:r.confidence||"Medium",evidence:Array.isArray(r.evidence)?r.evidence:[],suggested_props:Array.isArray(r.suggested_props)?r.suggested_props:[],ai_placeholder:!1};t.fallback_triggered&&console.log(`[Player AI] Fallback model used: ${t.model_used}`);let a={success:!0,playerId:o,playerName:i.full_name,question:g,...s,modelUsed:t.model_used,fallbackTriggered:t.fallback_triggered};return _.set(h,{response:a,timestamp:u}),_.size>100&&Array.from(_.entries()).forEach(([e,t])=>{u-t.timestamp>6e5&&_.delete(e)}),v.NextResponse.json(a)}catch(e){return console.error("AI Client Error:",e),v.NextResponse.json({success:!1,error:e.message||"AI service error"},{status:e.statusCode||500})}}catch(e){return console.error("Error in player AI route:",e),v.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}e.s(["POST",()=>A],15064);var x=e.i(15064);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/player-ai/route",pathname:"/api/player-ai",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/player-ai/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:C,workUnitAsyncStorage:T,serverHooks:I}=b;function O(){return(0,s.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:T})}async function k(e,t,s){b.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/player-ai/route";v=v.replace(/\/index$/,"")||"/";let y=await b.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:_,params:E,nextConfig:A,parsedUrl:x,isDraftMode:C,prerenderManifest:T,routerServerContext:I,isOnDemandRevalidate:O,revalidateOnlyGenerated:k,resolvedPathname:N,clientReferenceManifest:S,serverActionsManifest:P}=y,U=(0,l.normalizeAppPath)(v),M=!!(T.dynamicRoutes[U]||T.routes[N]),q=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,x,!1):t.end("This page could not be found"),null);if(M&&!C){let e=!!T.routes[N],t=T.dynamicRoutes[U];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await q();throw new R.NoFallbackError}}let L=null;!M||b.isDev||C||(L="/index"===(L=N)?"/":L);let j=!0===b.isDev||!M,D=M&&!j;P&&S&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:S,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let K=e.method||"GET",F=(0,n.getTracer)(),H=F.getActiveScopeSpan(),$={params:E,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>b.onRequestError(e,t,s,I)},sharedContext:{buildId:_}},B=new d.NodeNextRequest(e),Y=new d.NodeNextResponse(t),J=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let o=async e=>b.handle(J,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${K} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${K} ${v}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!i&&O&&k&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(a);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let d=$.renderOpts.collectedTags;if(!M)return await (0,h.sendResponse)(B,Y,n,$.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,s=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:O})},I),t}},p=await b.handleResponse({req:e,nextConfig:A,cacheKey:L,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:s.waitUntil,isMinimalMode:i});if(!M)return null;if((null==p||null==(n=p.value)?void 0:n.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",O?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&M||u.delete(f.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,g.getCacheControlHeader)(p.cacheControl)),await (0,h.sendResponse)(B,Y,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};H?await l(H):await F.withPropagatedContext(e.headers,()=>F.trace(u.BaseServerSpan.handleRequest,{spanName:`${K} ${v}`,kind:n.SpanKind.SERVER,attributes:{"http.method":K,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:U,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:O})}),M)throw t;return await (0,h.sendResponse)(B,Y,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>O,"routeModule",()=>b,"serverHooks",()=>I,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>T],12799)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f5f12215._.js.map