{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/samga/OneDrive/Desktop/AI%20Stat/with-supabase-app/app/api/update-username/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\n)\n\nexport async function POST(request: Request) {\n  try {\n    const { userId, username } = await request.json()\n\n    if (!userId || !username) {\n      return NextResponse.json(\n        { error: 'User ID and username are required' },\n        { status: 400 }\n      )\n    }\n\n    // Validate username format\n    const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/\n    if (!usernameRegex.test(username)) {\n      return NextResponse.json(\n        { error: 'Username must be 3-20 characters and contain only letters, numbers, and underscores' },\n        { status: 400 }\n      )\n    }\n\n    // Check if username is already taken by another user\n    const { data: existingUser, error: checkError } = await supabase\n      .from('profiles')\n      .select('id')\n      .eq('username', username)\n      .single()\n\n    if (existingUser && existingUser.id !== userId) {\n      return NextResponse.json(\n        { error: 'Username is already taken' },\n        { status: 400 }\n      )\n    }\n\n    // Update username\n    const { error: updateError } = await supabase\n      .from('profiles')\n      .upsert({\n        id: userId,\n        username: username,\n        updated_at: new Date().toISOString()\n      })\n\n    if (updateError) {\n      throw updateError\n    }\n\n    return NextResponse.json({\n      success: true,\n      message: 'Username updated successfully',\n      username\n    })\n  } catch (error: any) {\n    console.error('Update username error:', error)\n    return NextResponse.json(\n      { error: error.message || 'Failed to update username' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,WAAW,IAAA,yMAAY,gFAE3B,QAAQ,GAAG,CAAC,yBAAyB;AAGhC,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE/C,IAAI,CAAC,UAAU,CAAC,UAAU;YACxB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,gBAAgB;QACtB,IAAI,CAAC,cAAc,IAAI,CAAC,WAAW;YACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsF,GAC/F;gBAAE,QAAQ;YAAI;QAElB;QAEA,qDAAqD;QACrD,MAAM,EAAE,MAAM,YAAY,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SACrD,IAAI,CAAC,YACL,MAAM,CAAC,MACP,EAAE,CAAC,YAAY,UACf,MAAM;QAET,IAAI,gBAAgB,aAAa,EAAE,KAAK,QAAQ;YAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4B,GACrC;gBAAE,QAAQ;YAAI;QAElB;QAEA,kBAAkB;QAClB,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,YACL,MAAM,CAAC;YACN,IAAI;YACJ,UAAU;YACV,YAAY,IAAI,OAAO,WAAW;QACpC;QAEF,IAAI,aAAa;YACf,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAA4B,GACtD;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}